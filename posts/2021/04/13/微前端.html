<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>🚀微前端 | PINEHE-BLOG</title>
    <meta name="description" content="当我沉默的时候，我觉得很充实，当我开口说话，就感到了空虚。">
    
    
    <link rel="preload" href="/blog/assets/js/vendor.vue.5f1db0b8.js" as="script"><link rel="preload" href="/blog/assets/css/1.styles.62f82482.css" as="style"><link rel="preload" href="/blog/assets/js/vendor.commons.62f82482.js" as="script"><link rel="preload" href="/blog/assets/css/styles.fe65c3d9.css" as="style"><link rel="preload" href="/blog/assets/js/app.fe65c3d9.js" as="script"><link rel="preload" href="/blog/assets/css/styles.fe65c3d9.css" as="style"><link rel="preload" href="/blog/assets/css/8.styles.b27390c7.css" as="style"><link rel="preload" href="/blog/assets/js/8.b27390c7.js" as="script"><link rel="preload" href="/blog/assets/js/16.8c2128b8.js" as="script"><link rel="prefetch" href="/blog/assets/css/0.styles.3df2d085.css"><link rel="prefetch" href="/blog/assets/css/4.styles.a55d13b0.css"><link rel="prefetch" href="/blog/assets/css/5.styles.f5cce582.css"><link rel="prefetch" href="/blog/assets/css/6.styles.72588e95.css"><link rel="prefetch" href="/blog/assets/css/7.styles.6c9f8648.css"><link rel="prefetch" href="/blog/assets/js/0.3df2d085.js"><link rel="prefetch" href="/blog/assets/js/10.593b99a1.js"><link rel="prefetch" href="/blog/assets/js/11.5fc3c348.js"><link rel="prefetch" href="/blog/assets/js/12.8523f4b0.js"><link rel="prefetch" href="/blog/assets/js/13.2b0155fa.js"><link rel="prefetch" href="/blog/assets/js/14.4289d8c1.js"><link rel="prefetch" href="/blog/assets/js/15.84b27882.js"><link rel="prefetch" href="/blog/assets/js/17.3a1e5861.js"><link rel="prefetch" href="/blog/assets/js/18.1ccb3259.js"><link rel="prefetch" href="/blog/assets/js/19.63af8e22.js"><link rel="prefetch" href="/blog/assets/js/20.e6edaef8.js"><link rel="prefetch" href="/blog/assets/js/21.ed785718.js"><link rel="prefetch" href="/blog/assets/js/22.d2c06802.js"><link rel="prefetch" href="/blog/assets/js/23.5325aee8.js"><link rel="prefetch" href="/blog/assets/js/24.dbb5878a.js"><link rel="prefetch" href="/blog/assets/js/25.169bfe23.js"><link rel="prefetch" href="/blog/assets/js/26.23e44f9c.js"><link rel="prefetch" href="/blog/assets/js/27.a32093da.js"><link rel="prefetch" href="/blog/assets/js/28.3b2289e5.js"><link rel="prefetch" href="/blog/assets/js/29.343b0704.js"><link rel="prefetch" href="/blog/assets/js/30.eaccaf93.js"><link rel="prefetch" href="/blog/assets/js/4.a55d13b0.js"><link rel="prefetch" href="/blog/assets/js/5.f5cce582.js"><link rel="prefetch" href="/blog/assets/js/6.72588e95.js"><link rel="prefetch" href="/blog/assets/js/7.6c9f8648.js"><link rel="prefetch" href="/blog/assets/js/9.6f7602a8.js">
    <link rel="stylesheet" href="/blog/assets/css/1.styles.62f82482.css"><link rel="stylesheet" href="/blog/assets/css/styles.fe65c3d9.css"><link rel="stylesheet" href="/blog/assets/css/styles.fe65c3d9.css"><link rel="stylesheet" href="/blog/assets/css/8.styles.b27390c7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-neon"><header class="header" style="background-size:cover;background-repeat:no-repeat;background-position:center;background-attachment:scroll;background-image:url(https://yz.lol.qq.com/v1/assets/images/bilgewater-high-and-dry.jpg);" data-v-7ef4a8f4><div data-v-7c9b6a1e data-v-7ef4a8f4><nav class="navbar" data-v-7c9b6a1e><div class="container" data-v-7c9b6a1e><a href="/blog/" class="router-link-active" data-v-7c9b6a1e><span class="navbar-site-name" data-v-7c9b6a1e>
          PINEHE-BLOG
        </span></a> <div class="navbar-toggler" data-v-7c9b6a1e><svg class="icon" style="font-size:1.2em;" data-v-7c9b6a1e data-v-7c9b6a1e><title data-v-7c9b6a1e data-v-7c9b6a1e>menu</title><use xlink:href="#icon-menu" data-v-7c9b6a1e data-v-7c9b6a1e></use></svg></div> <div class="navbar-links" data-v-7c9b6a1e><a href="/blog/" class="navbar-link" data-v-7c9b6a1e>
            Home
          </a><a href="/blog/posts/" class="navbar-link router-link-active" data-v-7c9b6a1e>
            Posts
          </a><a href="/blog/custom-pages/" class="navbar-link" data-v-7c9b6a1e>
            Custom Pages
          </a><a href="https://github.com/superuserhe/blog" target="_blank" rel="noopener noreferrer" class="navbar-link" data-v-7c9b6a1e>
            Github
          </a></div></div></nav> <div class="navbar-holder" style="display:none;" data-v-7c9b6a1e></div></div> <div class="banner" data-v-e924d6e4 data-v-7ef4a8f4 data-v-7ef4a8f4><div class="container" data-v-e924d6e4><div class="center" data-v-e924d6e4><h1 data-v-e924d6e4 data-v-7ef4a8f4>
          🚀微前端
        </h1></div></div></div></header> <div class="container clearfix show-aside" data-v-2c3a28f0 data-v-2c3a28f0><main class="main" data-v-2c3a28f0><div class="post" data-v-2c3a28f0 data-v-2c3a28f0><section class="post-meta main-div" data-v-1956e4d1><section class="post-date clearfix" data-v-1956e4d1><span class="create-date" data-v-1956e4d1>
      发布时间 : 2021-04-13
    </span> <span class="update-date" data-v-1956e4d1>
      最后修改 : 2021-04-14
    </span></section> <section class="post-links" data-v-1956e4d1><a href="/blog/posts/2020/06/02/%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83.html" class="post-link" data-v-1956e4d1>
      上一篇 : 🚀前端代码规范
    </a> <a href="/blog/posts/2021/06/11/%E4%BD%BF%E7%94%A8react-%E5%8E%9F%E7%90%86%EF%BC%8C%E4%BC%98%E5%8C%96%E9%A1%B5%E9%9D%A2%E6%B8%B2%E6%9F%93%E5%8D%A1%E6%AD%BB%E9%97%AE%E9%A2%98.html" class="post-link" data-v-1956e4d1>
      下一篇 : 🚀使用react 原理，优化页面渲染卡死问题
    </a></section></section> <article class="main-div"><div class="post-content content default"><h1 id="微前端"><a href="#微前端" aria-hidden="true" class="header-anchor">#</a> 微前端</h1> <p>技术圈是比较爱炒概念的，<code>中台</code>、<code>微服务</code>、<code>DDD</code>一时都变成比较热门的话题，微前端作为微服务的一种自然也免不了俗。在我看来，大多数情况下大多数公司都用不上微前端。当然微前端不是什么新技术，只是为了解决实际问题的一种方法。微前端这三个字听起来不明所以，实际上只是将项目打散，变成若干小项目的合集，使用一种方案使得在多个项目之前平滑切换的方法。</p> <h2 id="为什么需要微前端"><a href="#为什么需要微前端" aria-hidden="true" class="header-anchor">#</a> 为什么需要微前端</h2> <p>前面说过，大多数情况下我们是不需要微前端的，通过清晰的组件划分，部分情况下使用 <code>iframe</code> 嵌入就能解决绝大部分问题。但是微前端对下面的问题解决起来更有优势：</p> <ol><li>迭代日积月累导致维护困难
一个生命周期超长的软件，必然产生出一个体积庞大的软件。软件会囊括各种交错复杂的业务逻辑，阅读维护起来特别困难。前端项目体积滋长还会使编译时间越来越长，本地开发热更新时电脑吃力，卡机。</li> <li>跨团队开发
若同一项目交给多个团队同时开发，由于是同一项目同一仓库，团队开发的资源并没有隔离经常会导致代码冲突，互相影响业务功能，造成开发风险。</li> <li>技术栈多样性
公司在逐步扩大业务，永远有新的业务需要上线，永远有新的技术栈在尝试。庞大的单体软件很难同时运行多个技术栈，很难在业务中尝试使用新的技术，举步维艰。</li></ol> <h2 id="技术方案"><a href="#技术方案" aria-hidden="true" class="header-anchor">#</a> 技术方案</h2> <ol><li><code>iframe</code> 嵌套多个子项目</li> <li><code>MPA</code> 多子项目之前通过链接跳转</li> <li>整合多个子项目资源，由主项目动态导航不同的子项目</li></ol> <hr> <p>这里重点介绍第三种， 比较知名的开源方案<code>Qiankun</code>。
<code>Qiankun</code> 使用了 <code>single-SPA</code> 的路由系统，且实现了一个 <code>sandbox</code>，用来隔离 <code>js</code> 运行环境</p> <hr> <p>以<code>Vue</code>作为主应用基座注册子应用示例</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/micro/index.ts</span>
<span class="token keyword">import</span> NProgress <span class="token keyword">from</span> <span class="token string">&quot;nprogress&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;nprogress/nprogress.css&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ant-design-vue&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 当前版本 qiankun 对 insertBefore 处理有问题，这里先使用修改后的本地包  es文件就是下载的修改后的本地包</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  registerMicroApps<span class="token punctuation">,</span>
  addGlobalUncaughtErrorHandler<span class="token punctuation">,</span>
  runAfterFirstMounted<span class="token punctuation">,</span>
  start<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./es&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> shared <span class="token keyword">from</span> <span class="token string">&quot;@/shared&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> apps <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token comment">/**
     * name: 微应用名称 - 具有唯一性
     * entry: 微应用入口 - 通过该地址加载微应用
     * container: 微应用挂载节点 - 微应用加载完成后将挂载在该节点上
     * activeRule: 微应用触发的路由规则 - 触发路由规则后将加载该微应用
     * props: 主应用给微应用传的值
  */</span>
  <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;ReactMicroApp&quot;</span><span class="token punctuation">,</span>
    entry<span class="token punctuation">:</span> <span class="token string">&quot;//localhost:10100&quot;</span><span class="token punctuation">,</span>
    container<span class="token punctuation">:</span> <span class="token string">&quot;#frame&quot;</span><span class="token punctuation">,</span>
    activeRule<span class="token punctuation">:</span> <span class="token string">&quot;/react&quot;</span><span class="token punctuation">,</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">{</span> shared <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">/**
    * 参数
    * apps - Array&lt;RegistrableApp&gt; - 必选，微应用的一些注册信息
    * lifeCycles - LifeCycles - 可选，全局的微应用生命周期钩子
 */</span>
<span class="token function">registerMicroApps</span><span class="token punctuation">(</span>apps<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// qiankun 生命周期钩子 - 微应用加载前</span>
  beforeLoad<span class="token punctuation">:</span> <span class="token punctuation">(</span>app<span class="token punctuation">:</span> any<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    NProgress<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;before load&quot;</span><span class="token punctuation">,</span> app<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// qiankun 生命周期钩子 - 微应用挂载后</span>
  afterMount<span class="token punctuation">:</span> <span class="token punctuation">(</span>app<span class="token punctuation">:</span> any<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    NProgress<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;after mount&quot;</span><span class="token punctuation">,</span> app<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 添加全局的未捕获异常处理器
 */</span>
<span class="token function">addGlobalUncaughtErrorHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span>event<span class="token punctuation">:</span> Event <span class="token operator">|</span> string<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> message<span class="token punctuation">:</span> msg <span class="token punctuation">}</span> <span class="token operator">=</span> event <span class="token keyword">as</span> any<span class="token punctuation">;</span>
   <span class="token comment">// 加载失败时提示</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token operator">&amp;&amp;</span> msg<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;died in status LOADING_SOURCE_CODE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;子应用加载失败，请检查应用是否可运行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">runAfterFirstMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;[MainApp] first app mounted&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 导出 qiankun 的启动函数</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> start<span class="token punctuation">;</span>


<span class="token comment">// src/micro/main.ts</span>
<span class="token keyword">import</span> startQiankun <span class="token keyword">from</span> <span class="token string">&quot;./micro&quot;</span><span class="token punctuation">;</span>

<span class="token function">startQiankun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在主应用注册好了微应用后，我们还需要对微应用进行一系列的配置。首先，我们在 <code>React</code> 的入口文件 <code>index.js</code> 中，导出 <code>Qiankun</code> 主应用所需要的三个生命周期钩子函数，代码实现如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">&quot;react-dom&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;antd/dist/antd.css&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;./App.jsx&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> SharedModule <span class="token keyword">from</span> <span class="token string">&quot;@/shared&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// window.__POWERED_BY_QIANKUN__为true说明运行在主应用容器里， 为false单独启动运行</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>__POWERED_BY_QIANKUN__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span>props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 当传入的 shared 不为空时，则重载子应用的 shared</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> shared <span class="token operator">=</span> SharedModule<span class="token punctuation">.</span><span class="token function">getShared</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  SharedModule<span class="token punctuation">.</span><span class="token function">overloadShared</span><span class="token punctuation">(</span>shared<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/**
 * bootstrap 只会在微应用初始化的时候调用一次，下次微应用重新进入时会直接调用 mount 钩子，不会再重复触发 bootstrap。
 * 通常我们可以在这里做一些全局变量的初始化，比如不会在 unmount 阶段被销毁的应用级别的缓存等。
 */</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;react app bootstraped&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 应用每次进入都会调用 mount 方法，通常我们在这里触发应用的渲染方法
 */</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;reactApp mount&quot;</span><span class="token punctuation">,</span> props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 应用每次 切出/卸载 会调用的方法，通常在这里我们会卸载微应用的应用实例
 */</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;react unmount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ReactDOM<span class="token punctuation">.</span><span class="token function">unmountComponentAtNode</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>子应用需导出 <code>bootstrap</code>、<code>mount</code>、<code>unmount</code>、<code>update</code>（可选）生命周期函数，用于在 <code>Qiankun</code> 生命周期中调用来挂载和卸载子应用。
在配置好了入口文件 <code>index.js</code> 后，我们新建 <code>config-overrides.js</code> 文件来配置 <code>webpack</code>，代码实现如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  webpack<span class="token punctuation">:</span> <span class="token punctuation">(</span>config<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 微应用的包名，这里与主应用中注册的微应用名称一致</span>
    config<span class="token punctuation">.</span>output<span class="token punctuation">.</span>library <span class="token operator">=</span> <span class="token template-string"><span class="token string">`ReactMicroApp`</span></span><span class="token punctuation">;</span>
    <span class="token comment">// 将你的 library 暴露为所有的模块定义下都可运行的方式</span>
    config<span class="token punctuation">.</span>output<span class="token punctuation">.</span>libraryTarget <span class="token operator">=</span> <span class="token string">&quot;umd&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 按需加载相关，设置为 webpackJsonp_ReactMicroApp 即可</span>
    config<span class="token punctuation">.</span>output<span class="token punctuation">.</span>jsonpFunction <span class="token operator">=</span> <span class="token template-string"><span class="token string">`webpackJsonp_ReactMicroApp`</span></span><span class="token punctuation">;</span>

    config<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>alias <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>config<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>alias<span class="token punctuation">,</span>
      <span class="token string">&quot;@&quot;</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> config<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  devServer<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>configFunction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> allowedHost<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">configFunction</span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> allowedHost<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 关闭主机检查，使微应用可以被 fetch</span>
      config<span class="token punctuation">.</span>disableHostCheck <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token comment">// 配置跨域请求头，解决开发环境的跨域问题</span>
      config<span class="token punctuation">.</span>headers <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token comment">// 配置 history 模式</span>
      config<span class="token punctuation">.</span>historyApiFallback <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> config<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>我们需要重点关注一下 <code>output</code> 选项，当我们把 <code>libraryTarget</code> 设置为 <code>umd</code> 后，我们的 <code>library</code> 就暴露为所有的模块定义下都可运行的方式了，主应用就可以获取到微应用的生命周期钩子函数了。</p> <hr> <h2 id="qiankun的核心原理"><a href="#qiankun的核心原理" aria-hidden="true" class="header-anchor">#</a> Qiankun的核心原理</h2> <ol><li><code>Qiankun</code> 实现了一个 <code>JS sandbox</code>，避免子应用之间的环境污染
实现逻辑：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> rawWindow <span class="token operator">=</span> window<span class="token punctuation">;</span>
<span class="token keyword">const</span> fakeWindow <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">as</span> Window<span class="token punctuation">;</span>

<span class="token keyword">const</span> sandbox<span class="token punctuation">:</span> WindowProxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>fakeWindow<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span>_<span class="token punctuation">:</span> Window<span class="token punctuation">,</span> p<span class="token punctuation">:</span> PropertyKey<span class="token punctuation">,</span> value<span class="token punctuation">:</span> any<span class="token punctuation">)</span><span class="token punctuation">:</span> boolean <span class="token punctuation">{</span>
      <span class="token comment">// 省略...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token keyword">get</span><span class="token punctuation">(</span>_<span class="token punctuation">:</span> Window<span class="token punctuation">,</span> p<span class="token punctuation">:</span> PropertyKey<span class="token punctuation">)</span><span class="token punctuation">:</span> any <span class="token punctuation">{</span>
      <span class="token comment">// 省略...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function">has</span><span class="token punctuation">(</span>_<span class="token punctuation">:</span> Window<span class="token punctuation">,</span> p<span class="token punctuation">:</span> string <span class="token operator">|</span> number <span class="token operator">|</span> symbol<span class="token punctuation">)</span><span class="token punctuation">:</span> boolean <span class="token punctuation">{</span>
      <span class="token keyword">return</span> p <span class="token keyword">in</span> rawWindow<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>Qiankun</code> 通过 <code>Proxy</code> 拦截了 <code>fakeWindow</code> 对象，在使用他们编写的插件 <code>import-html-entry</code> <code>load</code> 子应用 <code>js</code> 时将其作为子应用的 <code>window</code>，并且每个子应用生成的对象都不同。这样，就实现了每个子应用的环境独立，避免变量污染。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// get the entry html content and script executor</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> template<span class="token punctuation">:</span> appContent<span class="token punctuation">,</span> execScripts<span class="token punctuation">,</span> assetPublicPath <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">importEntry</span><span class="token punctuation">(</span>entry<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// compose the config getTemplate function with default wrapper</span>
    getTemplate<span class="token punctuation">:</span> <span class="token function">flow</span><span class="token punctuation">(</span>getTemplate<span class="token punctuation">,</span> <span class="token function">getDefaultTplWrapper</span><span class="token punctuation">(</span>appName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>settings<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//省略部分代码...</span>

<span class="token comment">// get the lifecycle hooks from module exports</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span> bootstrap<span class="token punctuation">:</span> bootstrapApp<span class="token punctuation">,</span> mount<span class="token punctuation">,</span> unmount <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">execScripts</span><span class="token punctuation">(</span>jsSandbox<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>Qiankun</code> 采用 <code>HTML Entry</code> 作为资源注入方式， <code>HTML Entry</code> 方式不需要单独提供挂载点，也不需要单独处理资源加载的问题，无论是挂载点还是资源都在 <code>HTML</code> 中，都能一次性全部解析到。<code>Qiankun</code> 拉取和解析 <code>html</code> 都是使用 <code>import-html-entry</code> 完成的。</p></div></article> <section class="post-meta main-div" data-v-1956e4d1><section class="post-date clearfix" data-v-1956e4d1><span class="create-date" data-v-1956e4d1>
      发布时间 : 2021-04-13
    </span> <span class="update-date" data-v-1956e4d1>
      最后修改 : 2021-04-14
    </span></section> <section class="post-links" data-v-1956e4d1><a href="/blog/posts/2020/06/02/%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83.html" class="post-link" data-v-1956e4d1>
      上一篇 : 🚀前端代码规范
    </a> <a href="/blog/posts/2021/06/11/%E4%BD%BF%E7%94%A8react-%E5%8E%9F%E7%90%86%EF%BC%8C%E4%BC%98%E5%8C%96%E9%A1%B5%E9%9D%A2%E6%B8%B2%E6%9F%93%E5%8D%A1%E6%AD%BB%E9%97%AE%E9%A2%98.html" class="post-link" data-v-1956e4d1>
      下一篇 : 🚀使用react 原理，优化页面渲染卡死问题
    </a></section></section> <div id="post-comments" class="main-div"><!----></div></div></main> <aside class="aside" data-v-2c3a28f0><div class="info-card main-div" data-v-6ed40700 data-v-2c3a28f0><div class="info-card-header" data-v-6ed40700><img src="/blog/assets/img/pine.jpg" alt="pineHe" class="info-avatar" data-v-6ed40700></div> <div class="info-card-body" data-v-6ed40700><section class="info-nickname" data-v-6ed40700>
      pineHe
    </section> <section class="info-desc" data-v-6ed40700>Happy Coding<br/>Happy Life</section> <section class="info-contact" data-v-6ed40700><section data-v-6ed40700><span title="Shen'zhen City, China" data-v-6ed40700 data-v-6ed40700><svg class="icon" style="font-size:1em;" data-v-6ed40700 data-v-6ed40700><title data-v-6ed40700 data-v-6ed40700>Shen'zhen City, China</title><use xlink:href="#icon-location" data-v-6ed40700 data-v-6ed40700></use></svg><span class="info-text" data-v-6ed40700 data-v-6ed40700>
          Shen'zhen City, China
        </span></span></section> <section data-v-6ed40700><span title="Shen'zhen Private Enterprise" data-v-6ed40700 data-v-6ed40700><svg class="icon" style="font-size:1em;" data-v-6ed40700 data-v-6ed40700><title data-v-6ed40700 data-v-6ed40700>Shen'zhen Private Enterprise</title><use xlink:href="#icon-organization" data-v-6ed40700 data-v-6ed40700></use></svg><span class="info-text" data-v-6ed40700 data-v-6ed40700>
          Shen'zhen Private Enterprise
        </span></span></section> <section data-v-6ed40700><a href="mailto:jsonHe557@163.com" title="jsonHe557@163.com" data-v-6ed40700 data-v-6ed40700><svg class="icon" style="font-size:1em;" data-v-6ed40700 data-v-6ed40700><title data-v-6ed40700 data-v-6ed40700>jsonHe557@163.com</title><use xlink:href="#icon-email" data-v-6ed40700 data-v-6ed40700></use></svg><span class="info-text" data-v-6ed40700 data-v-6ed40700>
          jsonHe557@163.com
        </span></a></section></section></div> <div class="info-card-footer" data-v-6ed40700><section class="info-sns clearfix" data-v-6ed40700><a href="https://github.com/superuserhe/blog" target="_blank" class="sns-link" data-v-6ed40700><span title="GitHub: superuserhe" class="sns-icon" data-v-6ed40700 data-v-6ed40700><svg class="icon" style="font-size:1.5em;" data-v-6ed40700 data-v-6ed40700><title data-v-6ed40700 data-v-6ed40700>GitHub: superuserhe</title><use xlink:href="#icon-github" data-v-6ed40700 data-v-6ed40700></use></svg></span></a></section></div></div> <div class="post-nav-card main-div" style="position:relative;top:0;width:0px;" data-v-2c3a28f0><div class="post-nav-contents"><svg class="icon"><title>book</title><use xlink:href="#icon-book"></use></svg> <span>文章目录</span> <div class="post-nav-toc"><ul><li><a href="/blog/posts/2021/04/13/%E5%BE%AE%E5%89%8D%E7%AB%AF.html#为什么需要微前端">为什么需要微前端</a></li><li><a href="/blog/posts/2021/04/13/%E5%BE%AE%E5%89%8D%E7%AB%AF.html#技术方案">技术方案</a></li><li><a href="/blog/posts/2021/04/13/%E5%BE%AE%E5%89%8D%E7%AB%AF.html#qiankun的核心原理">Qiankun的核心原理</a></li></ul></div></div> <div class="post-nav-comments"><svg class="icon"><title>comment</title><use xlink:href="#icon-comment"></use></svg> <a href="/blog/posts/2021/04/13/%E5%BE%AE%E5%89%8D%E7%AB%AF.html#post-comments">
      评论
    </a></div></div></aside></div> <footer class="footer" data-v-7fbc03fc><p class="sns-links" data-v-7fbc03fc><a href="https://github.com/superuserhe/blog" target="_blank" class="sns-link" data-v-7fbc03fc><span title="GitHub: superuserhe" class="sns-icon" data-v-7fbc03fc data-v-7fbc03fc><svg class="icon" style="font-size:25px;" data-v-7fbc03fc data-v-7fbc03fc><title data-v-7fbc03fc data-v-7fbc03fc>GitHub: superuserhe</title><use xlink:href="#icon-github" data-v-7fbc03fc data-v-7fbc03fc></use></svg></span></a></p> <p data-v-7fbc03fc><span data-v-7fbc03fc>Powered by </span> <a href="https://vuepress.vuejs.org" target="_blank" data-v-7fbc03fc>Vuepress</a></p></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/blog/assets/js/vendor.vue.5f1db0b8.js" defer></script><script src="/blog/assets/js/8.b27390c7.js" defer></script><script src="/blog/assets/js/16.8c2128b8.js" defer></script><script src="/blog/assets/js/vendor.commons.62f82482.js" defer></script><script src="/blog/assets/js/app.fe65c3d9.js" defer></script>
  </body>
</html>
